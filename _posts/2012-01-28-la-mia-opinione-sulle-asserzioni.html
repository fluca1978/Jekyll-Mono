---
layout: post
title: La mia opinione sulle asserzioni
date: '2012-01-28T15:52:00.000+01:00'
author: Luca Ferrari
tags:
- c++
- programmazione
- java
modified_time: '2012-01-28T12:52:34.902+01:00'
blogger_id: tag:blogger.com,1999:blog-1836481905487384887.post-3742348272233454299
blogger_orig_url: http://fluca1978.blogspot.com/2012/01/la-mia-opinione-sulle-asserzioni.html

permalink: /:year/:month/:day/:title.html
---


<h1>~</h1>


Ad una conferenza uno sviluppatore certificato ha fatto un commento che mi ha lasciato perplesso:<br /><blockquote class="tr_bq">"...sarebbe bello che le asserzioni funzionassero anche a run-time..."</blockquote><div style="text-align: justify;">Tale affermazione potrebbe essere estremamente fuorviante, ed è per questo che voglio esprimere la mia opinione sulle asserzioni e il loro uso. Una asserzione è un test su una condizione booleana che interrompe il flusso del programma qualora la condizione sia verificata. Ad esempio:</div><br /><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">assert( ! username.empty() );</span><br /><br />verifica che lo <i>username</i>&nbsp;non sia vuoto, nel qual caso interrompe (abort) l'esecuzione del programma.<br /><div style="text-align: justify;">Concettualmente una asserzione potrebbe essere considerata simile al seguente blocco di psudo-codice:</div><br /><span style="font-family: 'Courier New', Courier, monospace;">if( username.empty() )</span><br /><span style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp;throw new Error();</span><br /><br /><div style="text-align: justify;">Anche se concettualmente il pezzo di codice qui sopra è corretto, semanticamente è errato poiché non verifica che l'applicazione non sia in release mode, e quindi andrebbe riscritto come:</div><br /><span style="font-family: 'Courier New', Courier, monospace;">#ifdef DEBUG_MODE</span><br /><br /><span style="font-family: 'Courier New', Courier, monospace;">if( username.empty() )</span><br /><span style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp;throw new Error();</span><br /><span style="font-family: 'Courier New', Courier, monospace;">#endif</span><br /><br />o senza le macro di compilazione come:<br /><br /><br /><span style="font-family: 'Courier New', Courier, monospace;">if( debugMode &amp;&amp; &nbsp;username.empty() )</span><br /><span style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp;throw new Error();</span><br /><br /><br /><br /><div style="text-align: justify;">Per capire perché è così importante il test sulla modalità di debug occorre capire il vero scopo delle asserzioni. Le asserzioni non sono controlli di validità degli argomenti, sono controlli che condizioni impossibili non si possano mai verificare. Consideriamo un sistema di autenticazione:</div><br /><br /><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">private bool doAuthentication( String&amp; username, String&amp; password ){</span><br /><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">&nbsp; &nbsp; assert( ! username.empty() );</span><br /><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">&nbsp; &nbsp; assert( ! password.empty() );</span><br /><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;"><br /></span><br /><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">&nbsp; &nbsp; // do authentication stuff</span><br /><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">}</span><br /><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;"><br /></span><br /><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;"><br /></span><br /><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">public bool auth( String&amp; usnermae, String&amp; password ){</span><br /><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">&nbsp; &nbsp;if( username.empty() )</span><br /><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; // alert the user</span><br /><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">&nbsp; &nbsp;else if( password.empty() )</span><br /><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp;// alert the user</span><br /><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">&nbsp; &nbsp;else</span><br /><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">&nbsp; &nbsp; return doAuthentication( username, password );</span><br /><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">}</span><br /><br /><div style="text-align: justify;">L'idea è quella di avere un metodo di autenticazione, <i>auth</i>, pubblico e richiamabile dall'esterno, e una sua implementazione <i>doAuthentication</i>&nbsp;privata. Si noti che le asserzioni sono solo nell'implementazione, mentre il metodo pubblico effettua analoghi controlli ma senza asserzioni. In effetti quello che si vuole evitare è che il sistema di autenticazione sia richiamato con dati nulli, ossia che <i>doAuthentication</i>&nbsp;sia invocato con parametri vuoti. Questa è una condizione impossibile, non si deve mai verificare, e il compito delle asserzioni è di garantire che durante lo sviluppo non si introducano bug che coinvolgano una chiamata a <i>doAuthentication</i>&nbsp;con parametri vuoti. Ma dal lato utente bloccare l'esecuzione del programma perché i dati sono incompleti non è la scelta corretta: si devono comunque controllare i dati ed eventualmente informare l'utente (con un messaggio di errore) circa la completezza dei dati. In altre parole, si vuole evitare un abort pur tenendo i controlli a run-time. Dall'esempio di cui sopra si potrebbe riassumere che:</div><br /><ul><li>le asserzioni vengono usate per le implementazioni (metodi <i>non pubblici</i>) per controllare che non ci siano bug "vistosi";</li><li>le asserzioni non corrispondono a controlli di validazione;</li><li>i controlli dei parametri devono sempre essere presenti nei metodi pubblici, ossia si deve evitare di lavorare con dati <i>taint.</i></li></ul><div><br /></div>