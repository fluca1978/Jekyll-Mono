---
layout: post
title: Lo style puo' evitare bug?
date: '2014-02-26T18:51:00.000+01:00'
author: Luca Ferrari
tags:
- programmazione
- programming best practice
modified_time: '2014-02-26T18:51:00.591+01:00'
blogger_id: tag:blogger.com,1999:blog-1836481905487384887.post-9209853047446682774
blogger_orig_url: http://fluca1978.blogspot.com/2014/02/lo-style-puo-evitare-bug.html
---

<div style="text-align: justify;">Sono state spese molte parole sull'incidente di sicurezza della verifica dei certificati Apple in iOS, risolto tempestivamente con un aggiornamento dell'iOS da parte della casa madre (si veda <a href="https://www.imperialviolet.org/2014/02/22/applebug.html">qui</a> e anche <a href="http://support.apple.com/kb/HT6147">qui</a>).</div><div style="text-align: justify;">Il bug era, come spesso accade, banale: uno statement di troppo in una catena di "if" che causava l'interruzione della logica di valutazione dei condizionali. In pratica:</div><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">if ( condition 1 )</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; goto fail;</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">if ( condition 2 )</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; goto fail;</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; goto fail;   // &lt;&lt;&lt; disaster!!!!!!</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">if ( condition 3 )</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; goto fail;</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">fail:</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; // something nasty happenend</span><br /><br /><br /><div style="text-align: justify;">Si potrebbe dire che era necessario maggiore testing, che si dovrebbero usare le parentesi di blocco per ogni condizionale, che non si dovrebbero usare i goto....ma secondo me la cosa principale che ha generato il bug nel codice in oggetto e' stata la mancanza dell'uso degli "else". Le condizioni in esame erano da considerarsi logicamente correlate, ossia:</div><br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">if ( condition 1 )</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; goto fail;</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">else if ( condition 2 )</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; goto fail;</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; goto fail;   </span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">else if ( condition 3 )</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; goto fail;</span><br /><br /><div style="text-align: justify;">che avrebbe generato un errore di compilazione per un "else" spoglio. Con questo non voglio dire che il compilatore deve essere usato per trovare gli errori, per quello ci sono i test. Ad ogni modo il bug e' emerso da un semplice problema di code-style e non di logica. Ancora meglio sarebbe stato scrivere:</div><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">if ( condition 1</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; &nbsp; || condition 2</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; || condition 3 )</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; goto fail;</span><br /><br /><div style="text-align: justify;">che avrebbe "logicamente" correlato tutte le condizioni di fallimento.</div><div style="text-align: justify;">Questo bug rappresenta un esempio di come un code-style errato possa portare facilmente a errori banali, e si noti ancora una volta che il code style da adottare in questo caso non era tanto l'uso delle parentesi di blocco ma l'unione (con else o in un solo if) delle condizioni da testare.</div><div style="text-align: justify;">E si noti anche che non sempre il compilatore e' in grado di segnalare il "code-unreachable": come riportato <a href="http://blogs.perl.org/users/david_cantrell/2014/02/bugs-in-the-compiler.html">qui</a>&nbsp; GCC non implementa sempre questa funzione mentre CLANG la tiene disabilitata in default.</div>