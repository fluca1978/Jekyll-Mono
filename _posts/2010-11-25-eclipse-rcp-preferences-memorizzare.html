---
layout: post
title: 'Eclipse RCP Preferences: memorizzare informazioni di login in uno splash screen
  interattivo'
date: '2010-11-25T19:17:00.000+01:00'
author: Luca Ferrari
tags:
- eclipse
- rcp
- java
modified_time: '2010-11-25T19:17:00.209+01:00'
blogger_id: tag:blogger.com,1999:blog-1836481905487384887.post-3495735789347588613
blogger_orig_url: http://fluca1978.blogspot.com/2010/11/eclipse-rcp-preferences-memorizzare.html
---

<div style="text-align: justify;">Eclipse RCP mette a disposizione dello sviluppatore un sistema complesso di preferenze che possono essere usate per salvare, ad esempio, informazioni di login. Le preferenze di Eclipse possono essere di due tipi fondamentali:</div><ul style="text-align: justify;"><li>in chiaro</li><li>cifrate</li></ul><div style="text-align: justify;">Le ultime vengono salvate con un meccanismo a <i>keyring</i> e i plugin *.security forniscono tutti gli strumenti necessari al loro utilizzo. Ad esempio org.eclipse.equinox.security.ui permette la memorizzazione nel portachiavi con tanto di dialog per la configurazione del portachiavi stesso.&nbsp;</div><div style="text-align: justify;">Si pone tuttavia un problema per l'utilizzo delle preferenze cifrate: il workspace deve esistere ed essere in esecuzione. Ciò significa che lo sviluppatore ha piu' lavoro da svolgere nel caso in cui le preferenze siano usate da applicazioni RCP headless o, come nel mio caso, da splash screen interattivi (che agiscono prima del workspace stesso).</div><div style="text-align: justify;">Qui sotto riporto un esempio di utilizzo di un motore di salvataggio/caricamento dei dati dell'ultimo utente che ha effettuato il login nell'applicazione. In questo caso occorrerebbe salvare i dati in modo cifrato, ma essendo il mio un caso di splash screen interattivo, e trattandosi di dati comunque non fondamentali (poiché nella mia applicazione esistono altri meccanismi di sicurezza), ho deciso di usare per semplicità le preferenze in testo semplice. Da notare che il motore qui sotto proposto estrae ed inserisce i dati in un oggetto <i>User</i> che funge da wrapper per la business logic dietro all'utente stesso.</div><br /><br /><pre>public class UserPreferencesStorage {<br /><br />    private String PREFERENCES_USER_ROOT_NODE = "saved-user";<br />    private String PREFERENCES_USERNAME_NODE  = "username";<br />    private String PREFERENCES_PASSWORD_NODE  = "password";<br />    private String PREFERENCES_USER_PK_NODE   = "userpk";<br /><br /> <br />    /**<br />     * Saves the preferences of the provided user.<br />     * @param user the user that must contain the password and the username to store<br />     * @return true if the storage has been done<br />     */<br />    public boolean saveUserPreferences( User user ) throws BackingStoreException{<br /> try{<br />     // get the normal preferences and the scope for this plugin<br />     IEclipsePreferences preferences = new ConfigurationScope().getNode( Activator.PLUGIN_ID );<br />     // now get the main node for the configuration storage<br />     Preferences savedPreferences = preferences.node(PREFERENCES_USER_ROOT_NODE);<br /><br />     // now store the username and the password<br />     savedPreferences.put( PREFERENCES_USERNAME_NODE, user.getUsername() ); <br />     savedPreferences.put( PREFERENCES_PASSWORD_NODE, user.getPassword() ); <br />     savedPreferences.put( PREFERENCES_USER_PK_NODE, user.getPrimaryKey() + "" );  <br />     <br />     // flush the storage to ensure everything is written to disk<br />     preferences.flush();<br />     <br />     // all done<br />     return true;<br />     <br /> }catch( BackingStoreException se ){<br />     // log the exception and do nothing, cannot save<br />     IStatus status = new Status( IStatus.ERROR,     // severity<br />      Activator.PLUGIN_ID,      // the id of the application/plug-ing<br />      "Errore nel salvataggio delle preferenze di login utente",  // message<br />      se<br />     );<br /><br />     throw se;<br /> }<br /><br />    }<br />    <br />    <br />    /**<br />     * Loads a user from the prefences store.<br />     * @return the user loaded or null<br />     */<br />    public User loadUser() throws StorageException{<br /> // get the normal preferences and the scope for this plugin<br /> IEclipsePreferences preferences = new ConfigurationScope().getNode( Activator.PLUGIN_ID );<br /> // now get the main node for the configuration storage<br /> Preferences savedPreferences = preferences.node(PREFERENCES_USER_ROOT_NODE);<br /> <br /> // get the values from the storage<br /> String username  = savedPreferences.get(PREFERENCES_USERNAME_NODE, "");<br /> String password  = savedPreferences.get(PREFERENCES_PASSWORD_NODE, "");<br /> String primaryKey  = savedPreferences.get(PREFERENCES_USER_PK_NODE, "0");<br /> <br /> <br /> // create the user with such values<br /> User user = new User( Integer.parseInt(primaryKey), username, password );<br /> <br /> // all done<br /> return user;<br />    }<br />}</pre>