---
layout: post
title: Bloccare le connessioni MSN
date: '2008-05-16T10:44:00.000+02:00'
author: Luca Ferrari
tags:
- linux
modified_time: '2008-05-16T10:47:32.023+02:00'
blogger_id: tag:blogger.com,1999:blog-1836481905487384887.post-4892678112727557499
blogger_orig_url: http://fluca1978.blogspot.com/2008/05/bloccare-le-connessioni-msn.html

permalink: /:year/:month/:day/:title.html
---


<h1>~</h1>


Quello che mostro qui di seguito Ã¨ uno script shell che aggiunge delle regole ad un gateway Linux dotato di iptables per bloccare le connessioni MSN. Da notare che prima viene creata una catena di log, sulle quali sono poi loggate le connessioni, e poi si procede a bloccare le connessioni verso i principali host del servizio MSN.<br /><br /><pre>#!/bin/bash<br /><br /># Blocca le connessioni MSN<br /><br />IPTABLES_CMD=`which iptables`<br />FIREWALL=          # indirizzo IP del gateway<br />EXT_INTF=eth1<br />INT_INTF=eth0<br />LAN=192.168.1.0/255.255.255.0   # indirizzo della lan<br />PORT=1863<br />LOG_CHAIN="log_messenger"      # nome della catena di log<br />LOG_PREFIX=`basename $0`       # prefisso da attribuire ai messaggi di log, pari al nome<br />                              # di questo script, cosi' e' facile individuare lo script che blocca<br /><br />echo "Creazione del blocco per MSN..."<br /><br />$IPTABLES_CMD -N $LOG_CHAIN -v<br />$IPTABLES_CMD -A $LOG_CHAIN -j LOG --log-level debug --log-prefix "{ $0 } " -v<br />$IPTABLES_CMD -A $LOG_CHAIN -j DROP -v<br /><br /><br />echo "non viene utilizzato il blocco per MSN, riabilitare il file $0"<br />exit<br /><br /># Drop  della porta standard di MSN per i forward<br />$IPTABLES_CMD -A FORWARD -p tcp --dport $PORT -j DROP<br /><br /># creo una nuova catena per bloccare MSN<br />$IPTABLES_CMD -N MSNDENY > /dev/null<br />$IPTABLES_CMD -F MSNDENY<br />$IPTABLES_CMD -I MSNDENY -d 65.54.183.203     -j ACCEPT      # login.live.com<br />$IPTABLES_CMD -I MSNDENY -d 65.54.179.203     -j ACCEPT      # login.live.com<br />$IPTABLES_CMD -I MSNDENY -d 65.54.208.221     -j ACCEPT      # help.live.com<br />$IPTABLES_CMD -A MSNDENY -d 64.4.13.0/24      -j $LOG_CHAIN<br />$IPTABLES_CMD -A MSNDENY -d 64.12.163.0/24    -j $LOG_CHAIN<br />$IPTABLES_CMD -A MSNDENY -d 65.54.0.0/16      -j $LOG_CHAIN<br />$IPTABLES_CMD -A MSNDENY -d 152.163.241.0/24  -j $LOG_CHAIN<br />$IPTABLES_CMD -A MSNDENY -d 207.46.1.0/24     -j $LOG_CHAIN<br />$IPTABLES_CMD -A MSNDENY -d 207.46.110.0/24   -j $LOG_CHAIN<br />$IPTABLES_CMD -A MSNDENY -d 207.46.96.153     -j $LOG_CHAIN        # messenger.hotmail.com<br />$IPTABLES_CMD -A MSNDENY -d 80.67.86.64/28    -j $LOG_CHAIN       # msgr.dlservice.microsoft.com<br />$IPTABLES_CMD -A MSNDENY -d 193.238.160.0/24  -j $LOG_CHAIN     # www.ebuddy.com<br />$IPTABLES_CMD -A MSNDENY -d 8.6.13.62         -j $LOG_CHAIN            # www.ebuddy.com<br />$IPTABLES_CMD -A MSNDENY -d 66.150.161.128/28 -j $LOG_CHAIN    # www.webmessenger.co.uk<br />$IPTABLES_CMD -A MSNDENY -d 69.25.27.160/28   -j $LOG_CHAIN      # www.webmessenger.co.uk<br />$IPTABLES_CMD -A MSNDENY -d 216.129.112.0/24  -j $LOG_CHAIN     # www.meebo.com<br />$IPTABLES_CMD -A MSNDENY -d 65.19.140.246/24  -j $LOG_CHAIN     # www.meebo.com<br />$IPTABLES_CMD -A MSNDENY -d 216.32.64.0/19    -j $LOG_CHAIN       # iloveim.com<br />$IPTABLES_CMD -A MSNDENY -d 209.67.208.0/20   -j $LOG_CHAIN      # iloveim.com<br />$IPTABLES_CMD -A MSNDENY -d 72.232.0.0/16     -j $LOG_CHAIN        # iloveim.com<br />$IPTABLES_CMD -A MSNDENY -d 72.36.128.0/17    -j $LOG_CHAIN       # iloveim.com<br />$IPTABLES_CMD -A MSNDENY -d 194.109.193.71    -j $LOG_CHAIN       # www.onlinemessenger.nl<br />$IPTABLES_CMD -A MSNDENY -d 72.36.128.0/17    -j $LOG_CHAIN       # iloveim.com<br /><br /># blocco MSN<br />$IPTABLES_CMD -I FORWARD -j MSNDENY<br /><br /><br /></pre>