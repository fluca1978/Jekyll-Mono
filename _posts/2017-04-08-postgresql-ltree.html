---
layout: post
title: PostgreSQL ltree
date: '2017-04-08T17:24:00.000+02:00'
author: Luca Ferrari
tags:
- postgresql
modified_time: '2017-04-08T17:24:04.285+02:00'
blogger_id: tag:blogger.com,1999:blog-1836481905487384887.post-4663877916924393748
blogger_orig_url: http://fluca1978.blogspot.com/2017/04/postgresql-ltree.html

permalink: /:year/:month/:day/:title.html
---


<h1>~</h1>


<div style="text-align: justify;">Da un thread su una delle mailing list ufficiali ho appreso di un tipo di dato a me sconosciuto: <a href="https://www.postgresql.org/docs/current/static/ltree.html">ltree</a>.</div><div style="text-align: justify;">Un ltree rappresenta un <i>label tree</i>, quello che nei linguaggi di programmazione è un meccanismo di properties. In sostanza</div><div style="text-align: justify;">si definiscono delle etichette, ordinate gerarchicamente in base ad un separatore (il carattere <code>.</code>) e a queste si associa un valore.</div><div style="text-align: justify;">Esistono poi funzioni apposite di utilità per la navigazione e la ricerca nell'albero delle etichette.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Vediamo un esempio pratico: supponiamo di voler catalogare in un albero alcune informazioni basilari riguardo la nostra associazioni</div><div style="text-align: justify;">(dati assolutamente casuali e a puro scopo didattico!).</div><span style="font-size: large;"><br /></span><span style="font-size: large;"><br /></span><div class="org-src-container"><pre class="src src-sql"><span style="background-color: grey;"><span style="font-size: large;"><span style="color: #660000;"><span style="font-weight: bold;">CREATE</span> <span style="font-weight: bold;">TABLE</span>&nbsp;</span></span></span></pre><pre class="src src-sql"><span style="background-color: grey;"><span style="font-size: large;"><span style="color: #660000;">itpug( tipologia ltree, counter <span style="font-weight: bold;">integer</span> );</span></span><br /></span></pre></div><br />Ora si supponga di voler trovare il dettaglio dei soci, magari la loro somma partendo dalla foglia dell'albero:<br /><br /><br /><div class="org-src-container"><pre class="src src-sql"><span style="background-color: grey;"><span style="font-size: large;"><span style="color: #660000;"><span style="font-weight: bold;">SELECT</span> <span style="color: #4f97d7;">sum</span>( counter ) <span style="font-weight: bold;">&nbsp;</span></span></span></span></pre><pre class="src src-sql"><span style="background-color: grey;"><span style="font-size: large;"><span style="color: #660000;"><span style="font-weight: bold;">FROM</span> itpug <span style="font-weight: bold;">&nbsp;</span></span></span></span></pre><pre class="src src-sql"><span style="background-color: grey;"><span style="font-size: large;"><span style="color: #660000;"><span style="font-weight: bold;">WHERE</span> tipologia @&gt; <span style="color: aquamarine;">'itpug.soci'</span>;<br /> <span style="color: #4f97d7;">sum</span><br /><span style="background-color: white;"><span style="font-style: italic;">----</span></span><br />  <span style="font-style: italic; font-weight: bold;">50</span><br />(<span style="font-style: italic; font-weight: bold;">1</span> <span style="font-weight: bold;">row</span>)</span></span><br /></span></pre></div><br />Supponiamo di voler trovare tutte le informazioni relativi al <code>web</code> (si noti l'uso della tilde):<br /><br /><span style="background-color: white;"><br /></span> <br /><div class="org-src-container"><pre class="src src-sql"><span style="font-size: large;"><span style="color: #660000;"><span style="background-color: grey;"><span style="font-weight: bold;">SELECT</span> * <span style="font-weight: bold;">&nbsp;</span></span></span></span></pre><pre class="src src-sql"><span style="font-size: large;"><span style="color: #660000;"><span style="background-color: grey;"><span style="font-weight: bold;">FROM</span> itpug <span style="font-weight: bold;">&nbsp;</span></span></span></span></pre><pre class="src src-sql"><span style="font-size: large;"><span style="color: #660000;"><span style="background-color: grey;"><span style="font-weight: bold;">WHERE</span> tipologia ~ <span style="color: aquamarine;">'*.web.*'</span>;<br />         tipologia         | counter<br /><span style="font-style: italic;">---------------------------+---------</span><br /> itpug.web.siti            |       <span style="font-style: italic; font-weight: bold;">3</span><br /> itpug.web.ssl.certificati |       <span style="font-style: italic; font-weight: bold;">1</span><br />(<span style="font-style: italic; font-weight: bold;">2</span> <span style="font-weight: bold;">rows</span>)</span></span></span><br /></pre></div><br />Insomma, <i>ltree</i> si presenta come estensione sicuramente interessante, anche se forse un po' sorpassata dall'uso di altri formati quali <i>json</i> e <i>jsonb</i>.