---
layout: post
title: 'Connessione di unità di rete automatiche mediante file batch: createSambaBat.pl'
date: '2008-03-26T10:07:00.000+01:00'
author: Luca Ferrari
tags:
- linux
- perl
modified_time: '2008-03-26T12:41:48.327+01:00'
blogger_id: tag:blogger.com,1999:blog-1836481905487384887.post-6499794292877183657
blogger_orig_url: http://fluca1978.blogspot.com/2008/03/connessione-di-unit-di-rete-automatiche.html
---

Risulta molto comodo poter collegare unità di rete Windows con share Samba. Avendo una lista degli utenti e delle unità da collegare, è possibile utilizzare un semplice script Perl per la realizzazione di file batch che colleghino automaticamente all'avvio l'unità di rete prescelta. Lo script mostrato di seguito, denominato <span style="font-style: italic;">createSambaBat.pl</span> processa un file in formato csv nel quale devono essere inserite le informazioni relative a <span style="font-style: italic;">username</span>, <span style="font-style: italic;">password</span> (in chiaro), <span style="font-style: italic;">server a cui collegarsi</span>, <span style="font-style: italic;">unità di rete </span>sulla quale montare la share e la <span style="font-style: italic;">share</span> a cui collegarsi. Il programma crea un file .bat per ogni utente/server, nella forma <span style="font-style: italic;">username_server.bat</span>, che può contenere anche più share/unità per lo stesso utente (nel qual caso più righe per lo stesso utente devono essere specificate nel file CSV).<br /><br /><pre>#!/usr/bin/perl<br /><br /># $ARGV[0] = csv file for reading user credentials: it must have the following columns<br />#            username;password;drive;server;share<br /># $ARGV[1] = directory where the bat files will be stored<br /><br /><br /># * Copyright (C) Luca Ferrari 2008<br /># *<br /># *  This program is free software: you can redistribute it and/or modify<br /># *  it under the terms of the GNU General Public License as published by<br /># *  the Free Software Foundation, either version 3 of the License, or<br /># *  (at your option) any later version.<br /># *<br /># *  This program is distributed in the hope that it will be useful,<br />#    *  but WITHOUT ANY WARRANTY; without even the implied warranty of<br /># *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the<br /># *  GNU General Public License for more details.<br /># *<br /># *  You should have received a copy of the GNU General Public License<br /># *  along with this program.  If not, see <http: org="" licenses="">.<br /><br /># open the input file<br />open(INPUT_FILE, "<$ARGV[0]") || die("\nCannot open input file $ARGV[0]\n$!\n");  $written = 0;  # read each file from the file READLINE: while( $line = <input_file> ){<br />  @parts = split(";", $line);<br /><br />  $username = $parts[0];<br />  $password = $parts[1];<br />  $drive    = $parts[2];<br />  $server   = $parts[3];<br />  $share    = $parts[4];<br /><br />  $filename = $ARGV[1] . "/" . $username . "_" . $server . ".bat";<br /><br />  chomp($username);<br />  chomp($password);<br />  chomp($drive);<br />  chomp($server);<br />  chomp($share);<br /><br />  # create a file for the username<br />  if( open(BAT_FILE, ">>$filename") ){<br /><br /># store the information on the bat file<br />print BAT_FILE "NET USE $drive \\\\$server\\$share /USER:$username \"$password\"\n";<br />close(BAT_FILE);<br />$written++;<br />  }<br />  else{<br />warn("\nCannot write ouptu file $filename\n$!\n");<br />next READLINE;<br />  }<br /><br />}   # end of while<br /><br /><br />print "\nWritten $written files\n";<br /></input_file></http:></pre><br />Se il file di ingresso contiene le seguenti tuple:<br /><br /><div style="text-align: center;"><span style="font-style: italic;">luca.ferrari;LucFer;U:;myServer;myShare</span><br /></div><br />e viene invocato come<br /><br /><div style="text-align: center;"><span style="font-style: italic;">createSambaBat.pl file.csv .</span><br /></div><br />allora viene generato un file di nome <span style="font-style: italic;">luca.ferrari_mySever.bat</span> che contiene la seguente linea:<br /><br /><div style="text-align: center;"><span style="font-style: italic;">NET USE U: \\myServer\myShare /USER:luca.ferrari "LucFer"</span><br /></div><br />che consente a Windows di collegare <span style="font-style: italic;">\\myServer\myShare</span> come unità di rete <span style="font-style: italic;">U:</span>.<br /><br />A questo punto è sufficiente copiare il file batch nel computer di destinazione, magari direttamente sotto la cartella <span style="font-style: italic;">esecuzione automatica</span> del menù <span style="font-style: italic;">Start</span> per ottenere il collegamento dell'unità di rete all'avvio del computer. E' possibile rendere il file non modificabile, ma non va assolutamente messo come nascosto, altrimenti non verrà nemmeno eseguito.