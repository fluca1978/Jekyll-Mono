---
layout: post
title: Inserire le informazioni di build in un'applicazione Java
date: '2008-02-01T17:01:00.000+01:00'
author: Luca Ferrari
tags:
- java
modified_time: '2008-02-02T15:41:13.165+01:00'
blogger_id: tag:blogger.com,1999:blog-1836481905487384887.post-6009742757711074476
blogger_orig_url: http://fluca1978.blogspot.com/2008/02/inserire-le-informazioni-di-build-in.html
---

<span style="font-family: arial;">Una funzionalità molto comoda di Ant è quella di poter filtrare i file di testo (ivi inclusi i sorgenti Java) durante il processo di build. Tale filtraggio, ottenuto tramite i datatype </span><span style="font-style: italic; font-family: arial;">FilterSet</span><span style="font-family: arial;"> può essere utilizzato agevolmente per inserire le informazioni di build nel proprio applicativo, ad esempio nel titolo di una finestra o in una finestra di dialogo.</span><br /><br /><span style="font-family: arial;">Nell'esempio che riporto di seguito si andrà ad inserire il numero e la data di compilazione in una stringa specifica, contenuta in un file di proprietà. L'utilizzo di un file di proprietà con le stringhe e i messaggi da mostrare all'utente è comodo soprattuto perché consente l'internazionalizzazione. Tuttavia, è possibile filtrare direttamente un file .java che contenga la stringa equivalente.</span><br /><br /><span style="font-family: arial;">Si supponga di avere un file di proprietà che contenga, fra le altre, la proprietà che imposta il titolo della finestra principale dell'applicazione:</span><br /><br /><span style="font-family: arial;font-size:85%;" >application.title = My Application @APPLICATION_VERSION@</span><br /><br /><span style="font-family: arial;">Come è facile intuire il titolo dell'applicazione è formato da una parte statica e immutabile ("My Application") e da una variabile ("@APPLICATION_VERSION@"), quest'ultima che dovrà essere sostituita a </span><span style="font-style: italic; font-family: arial;">tempo di compilazione</span><span style="font-family: arial;"> con le informazioni di build. In sostanza, una volta terminato il processo di build si avrà qualche cosa di simile a:</span><br /><br /><span style="font-family:courier new;"><span style="font-family: arial;font-family:verdana;font-size:85%;"  >application.title = My Application [ build number 637 - 01/01/2008 ]</span><br /><br /><br /><span style="font-family: arial;">Per raggiungere lo scopo occorre filtrare con Ant il file di proprietà al momento in cui viene fatto il build. E' buona norma, all'atto di un build, creare uno spazio di build che sia identico (o simile) a quello in cui risiedono i sorgenti. Pertanto, immaginando di avere tale file di proprietà in una directory di configurazione e di volerlo copiare, assieme ad altri file di confifgurazione, nella directory relativa di build, il task da utilizzare è il seguente:<br /><br /></span><br /><span style="font-family: arial;font-family:verdana;font-size:85%;"  >&lt;target name="_copyConfig" depends="_createDirectoryStructure" &gt;<br /><br /> &lt;copy todir="${build.conf.dir}" &gt;<br /> &lt;fileset dir="${src.conf.dir}"&gt;<br />   &lt;/fileset&gt;<br /><br />   &lt;!-- filter the config files --&gt;<br />   &lt;filterset&gt;<br />       &lt;filter token="APPLICATION_VERSION"<br />                  value="[ build number ${build.number} -  ${build.timestamp} ]" /&gt;<br />    &lt;/filterset&gt;<br /><br /> &lt;/copy&gt;<br />&lt;/target&gt;</span><br /><br /><br /><span style="font-family: arial;">Brevemente quello che avviene è che tutti i file dalla directory di configurazione di origine (${src.conf.dir}) vengono spostati in quella di build (${build.conf.dir}), e nel fare questo i file vengono filtrati dal </span><span style="font-style: italic; font-family: arial;">FIlterSet</span><span style="font-family: arial;">: ogni file che contiene la stringa </span><span style="font-style: italic; font-family: arial;">@APPLICATION_VERSION@  </span><span style="font-family: arial;">viene modificato e al posto di quest'ultima si inseriscono le informazioni di build.</span><br /><br /><span style="font-family: arial;">Si noti che il task di cui sopra fa riferimento a due variabili: </span><span style="font-style: italic; font-family: arial;">${build.number}</span><span style="font-family: arial;"> e </span><span style="font-style: italic; font-family: arial;">${build.timestamp}</span><span style="font-family: arial;">. Entrambe le variabili devono esistere al momento del filtraggio, e quindi devono essere state definite precedente (all'inizio del file di build o in un task precedente quello corrente). La variabile  </span><span style="font-style: italic; font-family: arial;">${build.number} </span><span style="font-family: arial;">viene impostata tramite il task </span><span style="font-style: italic; font-family: arial;"><buildnumber></buildnumber></span><span style="font-style: italic; font-family: arial;">buildnumber</span><span style="font-family: arial;">, mentre quella </span><span style="font-style: italic; font-family: arial;">${build.timestamp}</span><span style="font-family: arial;"> viene generata tramite il task di timestamp. In sostanza:<br /><br /></span><br /><span style="font-family: arial;font-family:verdana;font-size:85%;"  > &lt;buildnumber/&gt;<br /></span><span style="font-family: arial;font-size:85%;" ><tstamp>  &lt;tstamp&gt;<br />       &lt;format property="build.timestamp"<br />                                               pattern="dd/MM/yyyy"/&gt;<br /> &lt;/tstamp&gt;<br /><br />      <format property="build.timestamp" pattern="dd/MM/yyyy"><br /></format></tstamp></span><br /><br /><span style="font-family: arial;">In conclusione Ant può essere utilizzato in modo molto efficace e flessibile per inserire informazioni di build all'interno della propria applicazione. L'esempio qui riportato ha illustrato il concetto, altre casistiche e casi d'uso più complessi sono ovviamente possibili.</span><br /></span>