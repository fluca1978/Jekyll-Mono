---
layout: post
title: tail-call goto
date: '2014-02-12T17:47:00.000+01:00'
author: Luca Ferrari
tags:
- perl
modified_time: '2014-02-12T17:47:00.065+01:00'
blogger_id: tag:blogger.com,1999:blog-1836481905487384887.post-5066866380454301352
blogger_orig_url: http://fluca1978.blogspot.com/2014/02/tail-call-goto.html

permalink: /:year/:month/:day/:title.html
---


<h1>~</h1>


<div style="text-align: justify;">In Perl l'istruzione <i>goto</i> ha diversi significati e utilizzi: oltre al "classico" salto verso una label infatti permette anche il salto verso una funzione da un'altra funzione. In questo caso avviene quella che viene spesso definita una <i>tail-call</i>, poiche' il salto rappresenta l'ultima istruzione eseguita sullo stack frame corrente.</div><div style="text-align: justify;">In occasione del salto tail-call gli argomenti <i>local</i> vengono resettati e la funzione di destinazione viene invocata come fosse stata invocata individualmente rimuovendo lo stack attuale; i parametri <i>@_</i> mantengono il loro valore attuale (ossia le modifiche sono propagate).</div><div style="text-align: justify;">Si consideri il seguente esempio:</div><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">#!/usr/bin/env perl -w</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">use v5.10;</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">$value = 10;</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">sub foo{</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">say "Inside foo and the value is $value";</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">say join ", ", caller;</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">}</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">sub bar{</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">local $value = 20;</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">say "Inside bar and the value is $value";</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">goto &amp;foo;</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">}</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">say "Let's start...";</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">say join ", ", caller;</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">say "...and now the magic!";</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">bar;</span><br /><br /><br /><div style="text-align: justify;">L'invocazione di caller serve a rendere visibile lo stack di chiamata, che nel caso del main e' assente.</div><div style="text-align: justify;">L'invocazione di bar effettua una modifica a <i>$value</i>, e poi una tail-call verso <i>foo</i>. A questo punto Perl rimuove dallo stack i dati di <i>bar</i> (rimuovendo quindi la localizzazione di <i>$value</i>) e invoca <i>foo</i> come se fosse stata chiamata direttamente dal main. E infatti il programma produce il seguente output:</div><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">Let's start...</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">...and now the magic!</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">Inside bar and the value is 20</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">Inside foo and the value is 10</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">main, test.pl, 22</span><br /><br /><div style="text-align: justify;">Da notare che l'output di caller produce un solo frame invocante, il <i>main</i>, anche se a prima vista <i>foo()</i> e' stata invocata tramite <i>bar()</i>.</div><div style="text-align: justify;">Da notare che il sigillo di subroutine e' obbligatorio per permettere a <i>goto</i> di comprendere che si tratta di un salto ad una funzione, non ad una label.</div>