---
layout: post
title: Sacchi di monete... Perl!
date: '2017-03-10T19:10:00.000+01:00'
author: Luca Ferrari
tags:
- perl
modified_time: '2017-03-10T19:10:07.021+01:00'
blogger_id: tag:blogger.com,1999:blog-1836481905487384887.post-2133997907204742223
blogger_orig_url: http://fluca1978.blogspot.com/2017/03/sacchi-di-monete-perl.html

permalink: /:year/:month/:day/:title.html
---


<h1>~</h1>


<br /><div id="content">C'è una baggianata che gira ultimamente su WhatsApp relativamente a mesi nei quali avvengono coincidenze stranissime: 5 domeniche, 5 sabati, ecc.<br />L'evento viene citato come rarissimo, tanto che si verificherebbe solo 823 anni (o qualcosa di simile).<br />Ovviamente si tratta del solito spam mirato solo a collezionare informazioni e numeri di telefono.<br /><br /><br />Ma sarà vero?<br />Basta scrivere qualche riga Perl per sapere quali sono i mesi nei quali sono presenti un certo numero di ripetizioni dello stesso giorno della settimana.<br />Ecco quindi la mia soluzione:<br /><br /><br /><br /><div class="org-src-container"><pre class="src src-perl"><span style="color: cyan; font-weight: bold;">use</span> <span style="color: violet; font-style: italic; font-weight: bold;">v5</span>.<span style="color: violet; font-style: italic; font-weight: bold;">20</span>;<br /><span style="color: cyan; font-weight: bold;">use</span> <span style="color: violet; font-style: italic; font-weight: bold;">DateTime</span>;<br /><span style="color: #ce537a; font-weight: bold;">my</span> $<span style="color: orange;">now</span> = DateTime-&gt;now();<br /><br /><span style="color: cyan; font-weight: bold;">for</span> ( <span style="color: violet; font-style: italic; font-weight: bold;">1</span>..<span style="color: violet; font-style: italic; font-weight: bold;">823</span> ){<br />    $<span style="color: orange;">now</span>-&gt;set( day =&gt; <span style="color: violet; font-style: italic; font-weight: bold;">1</span>, month =&gt; $<span style="color: orange;">_</span> )<br />    &amp;&amp;<br />    say <span style="color: aquamarine;">"Anno "</span> . $<span style="color: orange;">now</span>-&gt;year . <span style="color: aquamarine;">" mese "</span> . $<span style="color: orange;">now</span>-&gt;month<br />    . <span style="color: aquamarine;">" ha 5 "</span> . join <span style="color: aquamarine;">', '</span>, qw<span style="color: aquamarine;">( Lun Mar Mer Gio Ven Sab Dom )</span><br />    [ map {  $<span style="color: orange;">_</span> , ( $<span style="color: orange;">_</span> + <span style="color: violet; font-style: italic; font-weight: bold;">1</span> ) % <span style="color: violet; font-style: italic; font-weight: bold;">7</span> , ( $<span style="color: orange;">_</span> + <span style="color: violet; font-style: italic; font-weight: bold;">2</span> ) % <span style="color: violet; font-style: italic; font-weight: bold;">7</span>  } ($<span style="color: orange;">now</span>-&gt;day_of_week - <span style="color: violet; font-style: italic; font-weight: bold;">1</span> ) ]<br />        <span style="color: cyan; font-weight: bold;">for</span> ( grep { ( $<span style="color: orange;">_</span> % <span style="color: violet; font-style: italic; font-weight: bold;">2</span> == <span style="color: violet; font-style: italic; font-weight: bold;">0</span> &amp;&amp; $<span style="color: orange;">_</span> &gt; <span style="color: violet; font-style: italic; font-weight: bold;">7</span> ) || ( $<span style="color: orange;">_</span> % <span style="color: violet; font-style: italic; font-weight: bold;">2</span> == <span style="color: violet; font-style: italic; font-weight: bold;">1</span> &amp;&amp; $<span style="color: orange;">_</span> &lt;= <span style="color: violet; font-style: italic; font-weight: bold;">7</span> ) } ( <span style="color: violet; font-style: italic; font-weight: bold;">1</span>..<span style="color: violet; font-style: italic; font-weight: bold;">12</span> ) );<br /><br />    $<span style="color: orange;">now</span>-&gt;add( years =&gt; <span style="color: violet; font-style: italic; font-weight: bold;">1</span> );<br />}<br /></pre></div><br /><br />L'idea è semplice: anzitutto si filtrano i mesi con 31 giorni, funzione svolta dall'operatore <code>grep</code> che estrae i numeri di mese 1,3,5,7,8,10,12.<br />Questi vengono usati per impostare il mese corrente, si seleziona il primo giorno e si mappa il <code>day_of_week</code> in una lista di tre valori: la posizione del primo<br />giorno della settimana e dei due successivi adiacenti (modulo 7, ovviamente per consentire il "giro"). Il tutto viene poi stampato.<br />Il trucco è che il ciclo è postfisso, quindi va letto da destra a sinistra; inoltre l'inizializzazione del mese corrente è in "and" logico alla stampa<br />del valore, fatto che consente di usare un solo ciclo.<br />Per andare avanti di un anno, beh, basta aggiungere un anno e reiterare.<br />L'output è semplice:<br /><br /><br /><pre class="example">Anno 2838 mese 3 ha 5 Lun, Mar, Mer<br />Anno 2838 mese 5 ha 5 Sab, Dom, Lun<br />Anno 2838 mese 7 ha 5 Gio, Ven, Sab<br />Anno 2838 mese 8 ha 5 Dom, Lun, Mar<br /></pre><br />Questa soluzione si basa sul semplice fatto che tutti i mesi con 31 giorni hanno sempre 3 giorni consecutivi con ripetizione pari a 5.<br />Ma se non fosse noto ciò?<br />Beh, complicandosi la vita si può fare una soluzione general-purpose:<br /><br /><br /><div class="org-src-container"><pre class="src src-perl"><span style="color: cyan; font-weight: bold;">use</span> <span style="color: violet; font-style: italic; font-weight: bold;">v5</span>.<span style="color: violet; font-style: italic; font-weight: bold;">10</span>;<br /><span style="color: cyan; font-weight: bold;">use</span> <span style="color: violet; font-style: italic; font-weight: bold;">DateTime</span>;<br /><br /><span style="color: #ce537a; font-weight: bold;">my</span> ( $<span style="color: orange;">count</span> , $<span style="color: orange;">count_per_month</span>, $<span style="color: orange;">years</span>, $<span style="color: orange;">now</span>, $<span style="color: orange;">dow</span>, $<span style="color: orange;">ldom</span>, $<span style="color: orange;">cons</span> )<br />    = ( <span style="color: violet; font-style: italic; font-weight: bold;">5</span>, <span style="color: violet; font-style: italic; font-weight: bold;">3</span>, <span style="color: violet; font-style: italic; font-weight: bold;">823</span>,<br />        DateTime-&gt;now()-&gt;set( day =&gt; <span style="color: violet; font-style: italic; font-weight: bold;">1</span>, month =&gt; <span style="color: violet; font-style: italic; font-weight: bold;">1</span> ),<br />        <span style="color: cyan; font-weight: bold;">sub</span>{ qw<span style="color: aquamarine;">( Lun Mart Merc Giov Ven Sab Dom )</span>[ $<span style="color: orange;">_</span>[ <span style="color: violet; font-style: italic; font-weight: bold;">0</span> ] ] },<br />        <span style="color: cyan; font-weight: bold;">sub</span>{ $<span style="color: orange;">_</span>[ <span style="color: violet; font-style: italic; font-weight: bold;">0</span> ]-&gt;month != $<span style="color: orange;">_</span>[ <span style="color: violet; font-style: italic; font-weight: bold;">0</span> ]-&gt;clone-&gt;add( days =&gt; <span style="color: violet; font-style: italic; font-weight: bold;">1</span> )-&gt;month },<br />        <span style="color: cyan; font-weight: bold;">sub</span>{ $<span style="color: orange;">_</span>[ <span style="color: violet; font-style: italic; font-weight: bold;">0</span> ] == $<span style="color: orange;">_</span>[ <span style="color: violet; font-style: italic; font-weight: bold;">1</span> ] - <span style="color: violet; font-style: italic; font-weight: bold;">1</span> &amp;&amp; $<span style="color: orange;">_</span>[ <span style="color: violet; font-style: italic; font-weight: bold;">1</span> ] == $<span style="color: orange;">_</span>[ <span style="color: violet; font-style: italic; font-weight: bold;">2</span> ] - <span style="color: violet; font-style: italic; font-weight: bold;">1</span> } ) ;<br /><br /><span style="color: cyan; font-weight: bold;">for</span> ( <span style="color: violet; font-style: italic; font-weight: bold;">1</span>..( <span style="color: violet; font-style: italic; font-weight: bold;">365</span> * $<span style="color: orange;">years</span> ) ) {<br />    <span style="color: #ce537a; font-weight: bold;">my</span> $<span style="color: orange;">me</span> = \%{ $<span style="color: orange;">days_of</span>-&gt;{ $<span style="color: orange;">now</span>-&gt;year }-&gt;{ $<span style="color: orange;">now</span>-&gt;month } };<br />    ++ $<span style="color: orange;">me</span>-&gt;{ $<span style="color: orange;">now</span>-&gt;day_of_week - <span style="color: violet; font-style: italic; font-weight: bold;">1</span> };<br /><br />    say <span style="color: aquamarine;">"Anno "</span> . $<span style="color: orange;">now</span>-&gt;year . <span style="color: aquamarine;">" mese "</span> . $<span style="color: orange;">now</span>-&gt;month . <span style="color: aquamarine;">" =&gt; "</span><br />        . join <span style="color: aquamarine;">', '</span>,<br />        map { $<span style="color: orange;">me</span>-&gt;{ $<span style="color: orange;">_</span> } . <span style="color: aquamarine;">" "</span> . $<span style="color: orange;">dow</span>-&gt;( $<span style="color: orange;">_</span> )  }<br />          sort keys %$<span style="color: orange;">me</span><br />        <span style="color: cyan; font-weight: bold;">if</span> ( $<span style="color: orange;">ldom</span>-&gt;( $<span style="color: orange;">now</span> )<br />             &amp;&amp; ( grep { $<span style="color: orange;">_</span> &gt;= $<span style="color: orange;">count</span> } values %$<span style="color: orange;">me</span> )<br />             &gt;= $<span style="color: orange;">count_per_month</span><br />             &amp;&amp; $<span style="color: orange;">cons</span>-&gt;( ( grep { $<span style="color: orange;">me</span>-&gt;{ $<span style="color: orange;">_</span> } &gt;= $<span style="color: orange;">count</span> }  sort keys %$<span style="color: orange;">me</span> )  ) );<br /><br /><br />    $<span style="color: orange;">now</span>-&gt;add( days =&gt; <span style="color: violet; font-style: italic; font-weight: bold;">1</span> );<br />}<br /></pre></div><br /><br />Il funzionamento è abbastanza semplice, anche se un po' compatto.<br />Anzitutto mi affido a <i>DateTime</i> che fornisce una interfaccia ad oggetti per la gestione delle date.<br />Si inizializzano una serie di variabili:<br /><br /><ul class="org-ul"><li><i>$count</i> rappresenta quante ripetizioni dello stesso giorno della settimana sto cercando (5);</li><li><i>$count<sub>per</sub><sub>month</sub></i> rappresenta quante ripetizioni di <i>$count</i> ci devono essere in un mese. Ad esempio impostandolo al valore 3 significa<br />cercare almeno 3 giorni in un mese che si ripetano 5 volte (ossia il mese deve avere, ad esempio, almeno 5 sabati, 5 domeniche e 5 lunedì);</li><li><i>$years</i> su quanti anni da quello corrente si vuole iterare;</li><li><i>$now</i> la data corrente, impostata all'inizio dell'anno corrente;</li><li><i>$dow</i> è una routine di comodo che ritorna il nome simbolico del giorno della settimana (day of week);</li><li><i>$ldom</i> altra funzione di utilità che controlla se l'oggetto <code>DateTime</code> corrente rappresenta l'ultimo giorno della settimana. In particolare si controlla<br />se un <code>DateTime</code> successivo di un giorno ha un mese differente;</li><li><i>$cons</i> è una funzione che controlla che gli indici siano consecutivi fra loro (es 1,2,3), anche se ci vorrebbe la logica modulo 7 per<br />intercettare il giro di boa alla domenica…</li></ul><br />Da qui in poi si itera in un ciclo di 365 iterazioni per anno, salvando in un hash a piu' livelli il conteggio dei giorni della settimana di un mese.<br />L'hash assume una struttura dove al primo livello si trova l'anno corrente, poi il mese, poi il giorno della settimana, poi il conteggio di tale giorno.<br />Ad esempio una ipotetica iterazione potrebbe produrre:<br /><br /><br /><div class="org-src-container"><pre class="src src-perl">(<br /> <span style="color: violet; font-style: italic; font-weight: bold;">2017</span> =&gt; <span style="color: violet; font-style: italic; font-weight: bold;">1</span> =&gt; ( Lun =&gt; <span style="color: violet; font-style: italic; font-weight: bold;">3</span>,<br />                Mart =&gt; <span style="color: violet; font-style: italic; font-weight: bold;">3</span>,<br />                Mer  =&gt; <span style="color: violet; font-style: italic; font-weight: bold;">4</span>,<br />                Gio  =&gt; <span style="color: violet; font-style: italic; font-weight: bold;">5</span>,<br />                Ven =&gt; <span style="color: violet; font-style: italic; font-weight: bold;">3</span><br />                Sab =&gt; <span style="color: violet; font-style: italic; font-weight: bold;">3</span>,<br />                Dom =&gt; <span style="color: violet; font-style: italic; font-weight: bold;">3</span><br />);<br /></pre></div>La variabile <code>$me</code> serve solo a tenere il codice un po' piu' compatto, ossia ad accedere alla parte dell'anno/mese corrente<br />nel'hash globale.<br />Anzitutto si incrementa il contatore del giorno della settimana (già tradotto da numerico a mnemonico con <code>$dow</code>).<br />Segue un blocco <code>say..if</code>, quindi è opportuno partire prima dalla condizione <code>if</code>: se il giorno è di fine mese e si ha un conteggio di valori di singoli<br />giorni della settimana superiore a quello cercato si procede alla stampa. Questo consente di valutare se stampare il mese corrente solo se si è<br />iterato su tutti i giorni del mese e solo se si sono trovate almeni <code>$count_per_month</code> ripetizioni di giorni con conteggio di <code>$count</code>.<br />La parte di <code>say</code> include un <code>map</code> preso un prestito da un idioma ben noto, quindi va letto da destra a sinistra:<br /><br /><ol class="org-ol"><li>si ordinano le chiavi (nomi mnemonici dei giorni della settimana) dell'hash del mese corrente;</li><li>si crea una stringa con il conteggio di ripetizioni del giorno specificato e del suo nome mnemonico (parte <code>map</code>);</li><li>si effettua un join di tutte le stringhe così costruite.</li></ol><br />E quindi si stampa il tutto, con risultato analogo a quello del caso precedente.<br /></div><div class="status" id="postamble"><br /></div><br />