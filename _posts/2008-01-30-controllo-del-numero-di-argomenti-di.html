---
layout: post
title: Controllo del numero di argomenti di uno script shell
date: '2008-01-30T11:57:00.000+01:00'
author: Luca Ferrari
tags:
- linux
- università
modified_time: '2008-04-04T18:05:04.932+02:00'
blogger_id: tag:blogger.com,1999:blog-1836481905487384887.post-4136831144202933282
blogger_orig_url: http://fluca1978.blogspot.com/2008/01/controllo-del-numero-di-argomenti-di.html

permalink: /:year/:month/:day/:title.html
---


<h1>~</h1>


In molti esercizi di programmazione shell (Bourne Shell) proposti nei corsi di <a href="http://polaris.ing.unimo.it/didattica/soNOD/">Sistemi Operativi</a>  dell'<a href="http://www.unimore.it">Università degli Studi di Modena e Reggio Emilia</a> si richiede agli studenti di testare il numero di argomenti passati da linea di comando. Il controllo, chiaramente, dovrebbe essere implementato in ogni buon programma (non solo in quelli Shell) per assicurare che lo stesso possa eseguire con le corrette informazioni. Ovviamente, questo controllo da solo non è sufficiente, poiché deve essere seguito da un controllo sul tipo (ossia la validità) degli argomenti stessi. Tuttavia in questo articolo mi concentro solo sul controllo relativamente il numero degli argomenti.<br /><br />La Bourne Shell (così come la Bash) utilizzano la variabile speciale $# per memorizzare il numero di argomenti passati da riga di comando. In particolare $# memorizza il numero di argomenti <span style="font-style: italic;">realmente </span>passati allo script, ossia il numero di argomenti posizionali che seguono il nome dello script stesso (questo si differenzia dal C, dove il primo argomento è sempre il nome del programma stesso).<br /><br />Molte soluzioni proposte ai corsi di cui sopra implementano il controllo sul numero di argomenti con un costrutto case:<br /><br /><pre>case $# in<br />    0 | 1 | 2 | 3) echo "Troppi pochi argomenti"; exit 1;;<br />    4) ;;<br />    *) echo "Errore nel numero di argomenti"; exit 2;;<br />esac</pre>Nell'esempio riportato si fa il caso di uno script che accetta esattamente 4 parametri. In questo caso occorre scrivere un ramo del case per un numero di parametri inferiori a 4 (0,1,2,3), uno per il caso corretto (un ramo che non fa nulla) e uno per gli altri casi (che per esclusione risultano essere quelli con $# maggiore di 4).<br /><br />Questo tipo di soluzione è a mio avviso errata e non dovrebbe essere proposta per i seguenti motivi:<br /><ul><li>è una soluzione <span style="font-style: italic;">goffa</span>: se il numero esatto di parametri fosse alto, ad esempio 10, occorrerebbe enumerare singolarmente tutti i valori inferiori. Infatti, l'utilità del '*' è usata solo per un numero di parametri troppo evelato, ma non esiste il suo duale per pochi parametri;</li><li>è una soluzione lunga da scrivere: prevede la scrittura di almeno tre rami del case, quando le condizioni da testare sono solo due (maggiore e minore);</li><li>è una soluzione incline ad errori: inserire un ramo nel case che non opera nessuna operazione è pericolosa e mina la manutenibilità dello script stesso. Operazioni vitali potrebbero erroneamente finire nel ramo vuoto, o ci si potrebbe dimenticare del ';;' che segna la fine del case.</li></ul>La soluzione basata su if risulta come segue:<br /><br /><pre>if test $# -le 3<br />then<br />   echo "Troppi pochi argomenti"<br />   exit 1<br />else<br />   if test $# -gt 4<br />   then<br /> echo "Troppi argomenti"<br /> exit 2<br />   fi<br />fi<br /></pre><br />Apparentemente questa soluzione è più lunga della precedente, ma è una pura questione stilistica, visto che sarebbe possibile comprimere il codice come segue:<br /><br /><pre>if test $# -le 3; then  echo "Troppi pochi argomenti";  exit 1;<br />else<br />   if test $# -gt 4;     then  echo "Troppi argomenti"; exit 2;  fi<br />fi<br /></pre><br />così da risparmiare una riga rispetto al case. Ad ogni modo, le cose importanti da notare nella soluzione che sfrutta l'if sono:<br /><ul><li>è una soluzione flessibile: è possibile preimpostare con una variabile il numero esatto di argomenti attesi e lasciare inalterato il test;</li><li>è una soluzione compatta;</li><li>modella bene il caso che si vuole testare: troppi pochi parametri (if) o troppi parametri (else);</li><li>non richiede nessuna enumerazione dei casi non utilizzati (0,1,2,3);<br /></li><li>non presenta rami vuoti, se il test viene superato il programma prosegue normalmente.</li></ul>Per rendere ancora più flessibile la soluzione, è possibile usare la forma:<br /><br /><br /><pre>ARGC=4<br />if test $# -lt $ARGC; then  echo "Troppi pochi argomenti";  exit 1;<br />else<br />   if test $# -gt $ARGC;     then  echo "Troppi argomenti"; exit 2;  fi<br />fi</pre><br />Così facendo, eventuali evoluzioni dello script che prevedano un diverso numero di argomenti richiederanno la sola modifica del valore in ARGC.<br /><br />Da ultimo, si tenga presenta che tutte le soluzioni che prevedono un if sono da usarsi quando il numero delle casistiche da trattare non è eccessivamente elevato, mentre il case (o lo switch di Java/C) è da preferirsi quando si devono implementare comportamenti diversi in risposta a molte casistiche.