---
layout: post
title: 'The AgletsTranslator: considerations about the adoption of a ResourceBundle'
date: '2008-03-18T21:47:00.000+01:00'
author: Luca Ferrari
tags:
- aglets
- universit√†
- java
modified_time: '2008-03-19T08:31:39.295+01:00'
blogger_id: tag:blogger.com,1999:blog-1836481905487384887.post-3017680946242101603
blogger_orig_url: http://fluca1978.blogspot.com/2008/03/agletstranslator-considerations-about.html
---

The Java library provides the <span style="font-style: italic;">java.util.ResourceBundle</span> class that can be used to localize  within a Java run-time. Localizing means that each kind of resource can be adapted to the execution environment, in order to present to the users a more comprehensive resource. The simplest example is that of strings embedded in a program, that can be translated into the native language of the final users.<br /><br />Since mobile agents can run on very different hosts, it is important that they can provide to the final users a localized version of messages and other resources (e.g., icons, images). In this brief post I present my implementation of the <span style="font-style: italic;">org.aglets.util.AgletTranslator</span> class, that can be used both from agents and the platform to translate resources (mainly string messages).<br /><br />The <span style="font-style: italic;">AgletsTranslator</span> is a wrapper around the <span style="font-style: italic;">ResourceBundle</span> that provides simplified services for the localization. Let's start considering the class implementation base:<br /><br /><pre>public class AgletsTranslator implements Cloneable {<br /><br />  /**<br />   * The resource bundle used to handle locale content.<br />   */<br />  private transient ResourceBundle bundle = null;<br />  public String translate(String text){<br /> // be sure there is something to translate and I have a bundle to<br /> // ask for translation<br /> if( text != null &amp;&amp; text.length() > 0<br />  &amp;&amp; this.bundle != null<br />  &amp;&amp; this.bundle.containsKey(text)){<br />     String translated = null;<br />     translated = this.bundle.getString(text);<br />     logger.translation(text, translated);<br />     return translated;<br /> }<br /> else<br />     // nothing to do, return the string passed as argument<br />     return text;<br />  }<br /><br /> ...<br /><br />}</pre><span style="font-size:85%;"><span style="font-family:courier new;"></span> <span style="font-style: italic;font-family:courier new;" ></span></span>As readers can see, the class wraps an instance of a <span style="font-style: italic;">ResourceBundle</span>, and then provides the <span style="font-style: italic;">translate(String)</span> method that translates the text. The latter method works as follows: if the resource bundle contains the key (i.e., an identifier of the text that must be translated), then the returned text is provided  by the resource bundle (and thus is a translated text). If the bundle does not contain the key (i.e., cannot provide a translation for the specified text), then the untraslated text is provided. This means that, if the key passed as a string has not been included in the translation configuration, then this text will be returned unmodified. This allows, in any moment, an agent or a developer can try to translate a string without worring too much about its availability in the translation system. This also means that a developer can use always the <span style="font-style: italic;">translate(..)</span> method without worrying about the translation dictionary, that can become available even later the end of the development. So, the adoption of the <span style="font-style: italic;">translate(..)</span> method for issuing strings is a good practice.<br /><br />The <span style="font-style: italic;">AgletsTranslator</span> is constructed knowing a <span style="font-style: italic;">Locale</span> (i.e., an object that represents the configuration of the hosting platform) and a <span style="font-style: italic;">basename</span>. A basename represent a configuration point for a resource bundle. The basename can be either a class name (fully qualified name) that provides a translation by its own, or a file name (e.g., a property file) that is within the classpath. In the case of the <span style="font-style: italic;">AgletsTranslator</span>, the platform uses a property file called <span style="font-style: italic;">tahiti.properties</span> and placed within the <span style="font-style: italic;">lib</span> directory. The file contains a dictionary with entries like the followings:<br /><br /><pre>com.ibm.aglets.tahiti.LoginDialog.usernameLabel = Username:<br />com.ibm.aglets.tahiti.LoginDialog.passwordLabel = Password:<br />com.ibm.aglets.tahiti.LoginDialog.okButton      = Log in<br />com.ibm.aglets.tahiti.LoginDialog.okButton.tooltip   = Performs the log-in into Aglets<br />com.ibm.aglets.tahiti.LoginDialog.okButton.icon   = img/ok.png<br /></pre><br /><br />It is possible to see the key (e.g., <span style="font-style: italic;"><span style="font-style: italic;"><span style="font-style: italic;">com.ibm.aglets.tahiti.LoginDialog.usernameLabel</span></span></span>) and the appropriate translation (e.g., <span style="font-style: italic;">Username:</span>). Please note that a resource bundle can be used also for icons and images, not only for text, as already stated before.<br />The convention of using the fully qualified class name as part of the key is just a good practice that allows a quick individuation of where a key is used in the application itself.<br /><br />Having obtained an <span style="font-style: italic;">AgletsTranslator</span> its use is quite simple:<br /><br /><pre>AgletsTranslator translator = ...;<br />String translated = translator.translate("com.ibm.aglets.tahiti.LoginDialog.usernameLabel");<br />Icon icon = new ImageIcon( translator.translate("com.ibm.aglets.tahiti.LoginDialog.okButton.icon") );<br /><br /><br /></pre><br /><br />How can a translator  be obtained? The <span style="font-style: italic;">AgletsTranslator</span> class provides a factory method to obtain a new instance:<br /><br /><pre>public static AgletsTranslator getInstance(String localeBaseName, Locale currentLocale) {<br />   String key = localeBaseName + currentLocale.toString();<br /><br />   // search first in the cache<br />   if( translators.containsKey(key) )<br />       return translators.get(key);<br />   else{<br />     AgletsTranslator translator = new AgletsTranslator(localeBaseName, currentLocale);<br />     translators.put(key, translator);<br />     return translator;<br />   }<br /><br />}<br /><br />private static HashMap<string, agletstranslator=""> translators = new HashMap<string, agletstranslator="">();<br /></string,></string,></pre><br /><br /><br /><br />As readers can see the factory method searches first for an already constructed translated for the specified basename and locale. The adoption of such caching technique provides the same translator for the same code base, keeping the creation of translators under control and a lower memory footprint. In case the translator has not been created, it is created and a reference to it is stored in the <span style="font-style: italic;">translator</span> map for caching.