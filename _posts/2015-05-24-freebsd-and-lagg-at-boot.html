---
layout: post
title: FreeBSD and lagg at boot
date: '2015-05-24T11:40:00.000+02:00'
author: Luca Ferrari
tags:
- freebsd
modified_time: '2015-05-24T11:40:00.053+02:00'
blogger_id: tag:blogger.com,1999:blog-1836481905487384887.post-3164854879017081271
blogger_orig_url: http://fluca1978.blogspot.com/2015/05/freebsd-and-lagg-at-boot.html

permalink: /:year/:month/:day/:title.html
---


<h1>~</h1>


<div style="text-align: justify;">I was experimenting with my FreeBSD and lagg(4), the link aggregator.</div><div style="text-align: justify;">The idea is to perform a network interface teaming using more than one at the same time with a specific protocol, for instance, to provide high availability and redundancy.</div><div style="text-align: justify;">So I fired up my VirtualBox instance with the more NICs I could and did some aggregation. Nothing special so far.</div><div style="text-align: justify;">When I was satisfied, I tried to put the same configuration in /etc/rc.conf to enable it on boot, but here comes the problem: I was unable to create the lagg interface and, consequently, to aggregate NICs.</div><div style="text-align: justify;">It tooks me a while, but finally got the hint from the rc.conf(5) man page: cloned_devices! This variable contains a list of interfaces that are clonable, and therefore created on boot.</div><div style="text-align: justify;">Since it was not so simple to find out how to setup the rc.conf, the following is mine in the hope it can help anyone.</div><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;"><br /></span></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">############################</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">## Link Aggregation Setup ##</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">############################</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">#</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;"># First of all bring up the interface,</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;"># then create the lagg0 interface using the</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;"># cloned_interfaces (which in rc.conf means</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;"># to create the interface) and then</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;"># with a single command bring up the lagg0, specify the</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;"># protocol to use and add each interface (laggport).</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">#</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">#</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">ifconfig_em1="up"</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">ifconfig_em2="up"</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">ifconfig_em3="up"</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">cloned_interfaces="lagg0"</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">ifconfig_lagg0="up laggproto roundrobin laggport em1 laggport em2 laggport em3 192.168.200.222 netmask 255.255.255.0"</span></span><br /><br />