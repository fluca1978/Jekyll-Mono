---
layout: post
title: Ottenere lo username e il nome del gruppo principale in Linux
date: '2012-05-13T13:48:00.000+02:00'
author: Luca Ferrari
tags:
- c++
- linux
- qt
- c
- kde
modified_time: '2012-05-13T13:48:00.623+02:00'
blogger_id: tag:blogger.com,1999:blog-1836481905487384887.post-7711573654073832275
blogger_orig_url: http://fluca1978.blogspot.com/2012/05/ottenere-lo-username-e-il-nome-del.html

permalink: /:year/:month/:day/:title.html
---


<h1>~</h1>


<div style="text-align: justify;">Seppur semplice e scontato, riporto qui un pezzo di codice C che consente la <i>scoperta</i> dello username dell'utente che sta attualmente eseguendo l'applicazione e l'ottenimento del nome del primo gruppo a cui l'utente appartiene:</div><br /><span style="font-size: x-small;"><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">QString getUsername()</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">{&nbsp; </span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; // get the data about the user using the getpwuid(2) system call</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; uid_t&nbsp; currentUID_t&nbsp;&nbsp; = getuid();</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; struct passwd *st_pwd = getpwuid( currentUID_t );</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; </span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; </span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; if( st_pwd != NULL )</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; // convert the string with the username into a "good" string</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; return QString::fromLatin1( st_pwd-&gt;pw_name );</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; else</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; // error !</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; return QString::number( currentUID_t );</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">}</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">QString getGroupname()</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">{&nbsp; </span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; // get the data about the user using the getpwuid(2) system call</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; uid_t&nbsp; currentUID_t&nbsp;&nbsp; = getuid();</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; struct passwd *st_pwd = getpwuid( currentUID_t );</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; gid_t currentGID_t&nbsp;&nbsp;&nbsp;&nbsp; = getgid();</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; </span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; int ngroups = 1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // number of groups to be retrieved</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; gid_t *st_groups;</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; st_groups = (gid_t*) malloc( sizeof( gid_t ) * ngroups );</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; getgrouplist( st_pwd-&gt;pw_name,</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; currentGID_t,</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; st_groups,</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;ngroups</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; );</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; </span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; </span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; if( st_groups != NULL ){</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; // convert the string with the username into a "good" string</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; group* groupID = getgrgid( st_groups[0] );</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; return QString::fromLatin1( groupID-&gt;gr_name );</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; }</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; else</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; // error !</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; return QString::number( currentGID_t );</span><br style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="color: black; font-family: &quot;Courier New&quot;,Courier,monospace;">}</span></span><br /><br /><div style="text-align: justify;">Le due funzioni restituiscono entrambe un oggetto QString che pu√≤ quindi essere utilizzato in una applicazione Qt/KDE. Nel caso particolare di KDE conviene invece utilizzare l'oggetto di libreria <i>KUser</i> che alla sua creazione effettua autonomamente l'aggancio allo username e alla lista dei gruppi:</div><div style="background-color: white;"><br /></div><div style="background-color: white; font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">KUser user;</span></div><div style="background-color: white; font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">user.loginName();</span></div><div style="background-color: white; font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">user.groupNames().at( 0 );</span></div><div style="background-color: white; font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></div><br /><br /><br />