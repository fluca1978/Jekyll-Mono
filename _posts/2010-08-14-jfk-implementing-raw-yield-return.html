---
layout: post
title: 'JFK: implementing a raw yield return'
date: '2010-08-14T22:36:00.000+02:00'
author: Luca Ferrari
tags:
- jfk
- research
- java
modified_time: '2010-08-14T22:36:47.085+02:00'
blogger_id: tag:blogger.com,1999:blog-1836481905487384887.post-2183550851057830934
blogger_orig_url: http://fluca1978.blogspot.com/2010/08/jfk-implementing-raw-yield-return.html
---

<div style="text-align: justify;">A new feature has been added to JFK: a raw support for the <a href="http://msdn.microsoft.com/it-it/library/9k7k7cf0.aspx">yield return</a>.</div><div style="text-align: justify;">Before explaining it, please consider the cases when a yield return is useful: you are iterating over an iterator and want to return, one at a time, the next value extracted from the iterator.</div><div style="text-align: justify;">Consider the following method:</div><br /><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">public int cycle(){<br />&nbsp;&nbsp;&nbsp; for( int i : this.myIterable )<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return (i*i);<br />&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; return 0;</span></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">}</span></div><br /><div style="text-align: justify;">Now, supposing <i>myIterable</i> is an integer iterable that returns numbers from 0 to 1000, the above method does not cycle on all the values, but returns <b>always</b> the first element in the iterator (so it is 0). The adoption of <i>yield return</i> allows the iterator to return the next value each time the method is called.</div><div style="text-align: justify;">At the time of writing, JFK supports yield return when using iterators, and to get this support developers have to:</div><ol style="text-align: justify;"><li>use a class-level iterator (i.e., not in a local method scope);</li><li>annotate the iterator with the <i>@Yield</i> annotation to inform JFK that the adoption of such iterator can be yielded. Since JFK must have access to the iterator, in the case the latter is private, developers can indicate in the annotation a <i>get</i> method for the iterator itself.</li><li>ask JFK to build an instance that exploits the yield return.</li></ol><div style="text-align: justify;">The important thing to note in the above duties is that <i>no special bareword</i> or <i>special objects</i> must be used by developers: the methods are written as in normal Java.&nbsp;</div>So, taking back the above <i>cycle</i> method example, supposing the <i>myIterable</i><div style="text-align: justify;"> object has been annotatoted with the @Yield annotation, the following code will produce a progressive output:</div><br /><br /><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">IYieldBuilder yBuilder = JFK.getYieldBuilder();</span></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">// GoodYielder is an objet with the cycle method<br />GoodYielder gy = (GoodYielder) yBuilder.buildYielder( GoodYielder.class );<br />for( int i = 0; i &lt; 10; i++ )<br />&nbsp;&nbsp;&nbsp;&nbsp; System.out.println("Cycling with yield: " + gy.cycle() );</span></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"></div><br />will produce<br /><br /><span style="font-size: x-small;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cycling with yield: 1</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Cycling with yield: 4</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Cycling with yield: 9</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Cycling with yield: 16</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Cycling with yield: 25</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Cycling with yield: 36</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Cycling with yield: 49</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Cycling with yield: 64</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Cycling with yield: 81</span><br style="font-family: &quot;Courier New&quot;,Courier,monospace;" /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Cycling with yield: 100</span></span>&nbsp;&nbsp;&nbsp;&nbsp; <br /><br /><div style="text-align: justify;">The current support to yield return is really minimal and useful for a limited set of use cases. I'm currently investigating a more complete and general approach, keeping into account that no syntactic or semantic overhead will be introduced: the yielding must be declarative!</div><div style="text-align: justify;">In the meantime, if you need a more complete yielding mechanism (which is very different in syntax and semantic to JFK aim) have a look at <a href="http://chaoticjava.com/posts/category/code/java-language/frameworks/yielder/">Java Yielder</a> here.</div>