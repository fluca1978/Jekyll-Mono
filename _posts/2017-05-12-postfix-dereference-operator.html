---
layout: post
title: Postfix dereference operator
date: '2017-05-12T19:35:00.000+02:00'
author: Luca Ferrari
tags:
- perl
- planet-perl-ironman
modified_time: '2017-05-12T19:35:05.606+02:00'
blogger_id: tag:blogger.com,1999:blog-1836481905487384887.post-4137221473567704837
blogger_orig_url: http://fluca1978.blogspot.com/2017/05/postfix-dereference-operator.html

permalink: /:year/:month/:day/:title.html
---


<h1>~</h1>


<span style="font-size: small;">Starting from Perl 5.20 it is allowed to use a <a href="http://perldoc.perl.org/perlref.html#Postfix-Dereference-Syntax">postfix dereference notation</a>, first as an explicit feature, and since Perl 5.24 it is enabled by default.</span><br /><span style="font-size: small;">The postfix dereference notation allows you to use the arrow operator <code>-&gt;</code> on a reference (as often used when combined with references) specifying the <i>type</i> of the deferencing you want to. Types are indicated by their well know sigils, so for instance a <code>$</code> means a scalar, a <code>@</code> an array, <code>&amp;</code> is for a subroutine, <code>%</code> for an hash and <code>*</code> for a typeglob. The sigil on the right of the arrow operator is enhanced by a star, so it really becomes <i>type</i> and <i>*</i>, as in <code>$*</code>. In the special case of arrays and hashes the star can be dropped in favor of a slicing operator, e.g., the square brackets.</span><br /><span style="font-size: small;">The following is a sample program that prints out the values of an array using full access (<code>-&gt;@*</code>) and slicing (<code>-&gt;@[]</code>):</span><br /><br /><div class="sourceCode"><pre class="sourceCode perl"><span style="font-size: small;"><code class="sourceCode perl"><span class="co">#!env perl</span><br /><span class="fu">use</span> v5.<span class="dv">24</span>;<br /><br /><span class="kw">my</span> <span class="dt">@array</span> = ( <span class="kw">'</span><span class="st">a</span><span class="kw">'</span> .. <span class="kw">'</span><span class="st">z</span><span class="kw">'</span> );<br /><span class="kw">my</span> <span class="dt">$ref</span>   = \<span class="dt">@array</span>;<br />say <span class="kw">"</span><span class="st">Here comes the array </span><span class="dt">@</span><span class="st">{ </span><span class="dt">$ref</span><span class="st"> }</span><span class="kw">"</span>;<br />say <span class="kw">"</span><span class="st">And post dereferences is </span><span class="dt">$ref</span>-&gt;<span class="dt">@</span><span class="st">*</span><span class="kw">"</span>;<br /><br />say <span class="kw">"</span><span class="st">Here comes a slice </span><span class="dt">@</span><span class="st">{ </span><span class="dt">$ref</span><span class="st"> }[ 0 .. 5 ]</span><span class="kw">"</span>;<br />say <span class="kw">"</span><span class="st">And using it as post dereference is </span><span class="dt">$ref</span>-&gt;<span class="dt">@</span><span class="st">[ 0 .. 5 ]</span><span class="kw">"</span>;</code></span></pre><pre class="sourceCode perl"><span style="font-size: small;"><code class="sourceCode perl">&nbsp;</code></span></pre><pre class="sourceCode perl"><span style="font-size: small;"><code class="sourceCode perl">&nbsp;</code></span></pre></div><span style="font-size: small;">As you can see, <code>$ref-&gt;@*</code> is the equivalent of <code>@{ $ref }</code>, while <code>$ref-&gt;@[]</code> is the same as <code>@{ $ref }[]</code>. The same applies to hash references.</span><br /><span style="font-size: small;">Code and subroutine references are a little more controversial, at least to my understanding of references. First of all there is only the <i>star</i> operator, so <code>-&gt;&amp;*</code>, and the behavior is such that <code>$ref-&gt;&amp;*</code> is the same as <code>&amp;{ $ref }</code>. This makes me think there is no short way of passing method arguments thru a postfix deference, as the following code demonstrates:</span><br /><br /><div class="sourceCode"><pre class="sourceCode perl"><span style="font-size: small;"><code class="sourceCode perl"><span class="co">#!env perl</span><br /><span class="fu">use</span> v5.<span class="dv">24</span>;<br /><br /><span class="kw">my</span> <span class="dt">$sub_ref</span> = <span class="kw">sub </span>{ say <span class="kw">"</span><span class="st">Hello sir </span><span class="dt">@_</span><span class="st"> !</span><span class="kw">"</span> };<br /><span class="dt">$sub_ref</span>-&gt;( <span class="kw">'</span><span class="st">Luca</span><span class="kw">'</span> );         <span class="co"># Hello sir Luca !</span><br />&amp;{ <span class="dt">$sub_ref</span> }( <span class="kw">'</span><span class="st">Luca</span><span class="kw">'</span> );      <span class="co"># Hello sir Luca !</span><br /><span class="dt">$sub_ref</span>-&gt;&amp;<span class="kw">*</span> ;                <span class="co"># Hello sir  !</span><br />{ <span class="dt">$sub_ref</span>-&gt;&amp;<span class="kw">*</span> }( <span class="kw">'</span><span class="st">Luca</span><span class="kw">'</span> );   <span class="co"># Hello sir  !</span><br />&amp;<span class="dt">$sub_ref</span>( <span class="kw">'</span><span class="st">Luca</span><span class="kw">'</span> );          <span class="co"># Hello sir Luca !</span></code></span></pre></div><br /><span style="font-size: small;">If you try to pass arguments in any way to the <code>-&gt;&amp;*</code> dereferencing, you got either a compile time error or a code that does not what you expect:</span><br /><br /><div class="sourceCode"><pre class="sourceCode perl"><span style="font-size: small;"><code class="sourceCode perl">{ <span class="dt">$sub_ref</span>-&gt;&amp;&gt;<span class="kw">*</span> }( <span class="kw">'</span><span class="st">Luca </span><span class="kw">'</span>);   <span class="co"># Hello sir  !</span><br /><span class="dt">$sub_ref</span>-&gt;&amp;( <span class="kw">'</span><span class="st">Luca</span><span class="kw">'</span> );        <span class="co"># syntax error at tmp/ref.pl line 19, near "-&gt;&amp;"</span><br /><span class="dt">$sub_ref</span>-&gt;&amp;*( <span class="kw">'</span><span class="st">Luca</span><span class="kw">'</span> );       <span class="co"># syntax error at tmp/ref.pl line 20, near "&amp;*( "</span><br />{ <span class="dt">$sub_ref</span>-&gt;&amp; }( <span class="kw">'</span><span class="st">Luca </span><span class="kw">'</span>);    <span class="co"># syntax error at tmp/ref.pl line 21, near "-&gt;&amp;"</span></code></span></pre></div><br /><span style="font-size: small;">The only <i>catch-all</i> way of passing arguments, as suggested on <i>irc.perl.org</i>, is to use the <code>@_</code>, so I suggest to localize it:</span><br /><br /><span style="font-size: small;">{&nbsp;</span><br /><span style="font-size: small;">&nbsp; local <span class="citation">@_</span> = qw( Luca );&nbsp;</span><br /><span style="font-size: small;">&nbsp; $sub_ref-&gt;&amp;*; # Hello sir Luca !&nbsp;</span><br /><span style="font-size: small;">}</span><br /><span style="font-size: small;"><br /></span><span style="font-size: small;">I must admit this is a little too much for my poor brain in order to efficiently use the references, so if anyone has something to comment is truly welcome!</span><br /><span style="font-size: small;">Now, back to the main topic, it seems to me that the <i>postfix dereference notation</i> is a way of managing reference more like objects, at least it reminds me a kind of <code>as_xx</code> methods (yes, Ruby-ers, I'm looking at you). If we read the arrow operator like <i>as</i> and the type on sigil on the right as the type name, we have that, for instance:</span><br /><ul><li><span style="font-size: small;"><code>$ref-&gt;$*</code> is <i>$ref as scalar</i>;</span></li><li><span style="font-size: small;"><code>$ref-&gt;@*</code> is <i>$ref as array</i> or <code>$ref&gt;@[]</code> becomes <i>$ref as array slice</i></span></li></ul><span style="font-size: small;">and so on. While I'm pretty sure this is not the real meaning of this notation, it is sure most readable than the "usual" one, where we have the type on the left and the reference on the right (or better in the middle), as in <code>@$ref</code> or <code>@{ $ref }</code>.</span>